
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Windows Functions &#8212; The Data Science Interview Book</title>
    
  <link href="../../_static/css/theme.css" rel="stylesheet" />
  <link href="../../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/sphinx-book-theme.e8f53015daec13862f6db5e763c41738.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <link rel="canonical" href="https://dipranjan.github.io/dsinterviewqns/contents/SQL/Windows Functions.html" />
    <link rel="shortcut icon" href="../../_static/logo.gif"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Functions" href="Functions.html" />
    <link rel="prev" title="Joins" href="Joins.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
      <img src="../../_static/logo.gif" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">The Data Science Interview Book</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../intro.html">
   About this Book
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  To Do
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../To%20Do%20List.html">
   To Do
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Statistics
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../Statistics/Probability%20Basics.html">
   Probability Basics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Statistics/Probability%20Distribution.html">
   Probability Distribution
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Statistics/Central%20Limit%20Theorem.html">
   Central Limit Theorem
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Statistics/Bayesian%20vs%20Frequentist%20Reasoning.html">
   Bayesian vs Frequentist Reasoning
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Statistics/Hypothesis%20Testing.html">
   Hypothesis Testing
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Data
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../Data/Scaling.html">
   Scaling
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Algorithms
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../Algorithms/Regression.html">
   Regression
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Algorithms/Generative%20VS%20Discriminative%20Models.html">
   Generative vs Discriminative Models
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Algorithms/Classification.html">
   Classification
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Algorithms/Time%20Series%20Analysis.html">
   Time Series Analysis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Algorithms/Anomaly%20Detection.html">
   Anomaly Detection
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  NLP
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../NLP/Lexical%20Processing.html">
   Lexical Processing
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Python
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../Python/Basics.html">
   Basics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Python/Data%20Manipulation.html">
   Data Manipulation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Python/Statistics.html">
   Statistics
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  SQL
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="Select.html">
   SQL Basics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Joins.html">
   Joins
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Windows Functions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Functions.html">
   Functions
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Excel
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../Excel/Excel%20Basics.html">
   Excel Basics
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Tensorflow
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../Tensorflow/Basics.html">
   Basics
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Analytical Thinking
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../Analytical%20Thinking/Business%20Scenarios.html">
   Business Scenarios
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  <a href="https://www.buymeacoffee.com/dearc" target="_blank"><img src="https://cdn.buymeacoffee.com/buttons/default-orange.png" alt="Buy Me A Coffee" height="41" width="174"></a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/contents/SQL/Windows Functions.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.md</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/dipranjan/dsinterviewqns"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/dipranjan/dsinterviewqns/issues/new?title=Issue%20on%20page%20%2Fcontents/SQL/Windows Functions.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        <a class="edit-button" href="https://github.com/dipranjan/dsinterviewqns/edit/master/contents/SQL/Windows Functions.md"><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Edit this page"><i class="fas fa-pencil-alt"></i>suggest edit</button></a>
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#common-windows-functions">
   Common Windows Functions
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#questions">
   Questions
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="windows-functions">
<h1>Windows Functions<a class="headerlink" href="#windows-functions" title="Permalink to this headline">¶</a></h1>
<p><strong>Reference:</strong> <a class="reference external" href="https://www.red-gate.com/simple-talk/sql/t-sql-programming/introduction-to-t-sql-window-functions/">📖Explanation</a>, <a class="reference external" href="https://dbfiddle.uk/?rdbms=sqlserver_2017&amp;fiddle=6379904805d1f465cc0f6ea33fc3c0d6">🔫Playground</a></p>
<p>Window (also, windowing or windowed) functions perform a calculation over a set of rows. I like to think of “looking through the window” at the rows that are being returned and having one last chance to perform a calculation. The window is defined by the OVER clause which determines if the rows are partitioned into smaller sets and if they are ordered.
They allow you to add your favourite aggregate function to a non-aggregate query. Similar to Transform is pandas group by clause.</p>
<div class="section" id="common-windows-functions">
<h2>Common Windows Functions<a class="headerlink" href="#common-windows-functions" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><strong>Ranking functions</strong></p>
<ul>
<li><p><strong>ROW_NUMBER:</strong> is used to add unique row numbers to a partition or to the entire result set. It has the ability to turn non-unique rows into unique rows</p></li>
<li><p><strong>RANK:</strong> it will give numbers same as row_number just that same data will get same rank</p></li>
<li><p><strong>DENSE_RANK:</strong> doesnot skip and rank number</p></li>
<li><p><strong>NTILE:</strong> It assigns bucket numbers to the rows instead of row numbers or ranks</p></li>
</ul>
</li>
</ul>
<div class="figure align-default" id="image2">
<img alt="../../_images/image24.PNG" src="../../_images/image24.PNG" />
<p class="caption"><span class="caption-number">Fig. 17 </span><span class="caption-text">Ranking functions, check playground to work with this</span><a class="headerlink" href="#image2" title="Permalink to this image">¶</a></p>
</div>
<ul class="simple">
<li><p><strong>Offset functions</strong></p>
<ul>
<li><p><strong>LAG:</strong>  the function allows you to pull columns or expressions from a row before the current row</p></li>
<li><p><strong>LEAD:</strong> the function allows you to pull columns or expressions from a row after the current row</p></li>
<li><p><strong>FIRST_VALUE:</strong> the functions allows you to return values from the first row of the partition</p></li>
<li><p><strong>LAST_VALUE:</strong> the functions allows you to return values from the last row of the partition</p></li>
</ul>
</li>
<li><p><strong>Statistical functions</strong>
– <strong>PERCENT_RANK:</strong> returns the percentage of rows that rank lower than the current row, its formula is <span class="math notranslate nohighlight">\(\frac{\text{Rank} -1}{\text{Row count} -1}\)</span></p>
<ul>
<li><p><strong>CUME_DIST:</strong> cumulative distribution, returns the exact rank, its formula is <span class="math notranslate nohighlight">\(\frac{\text{Rank}}{\text{Row count}}\)</span></p></li>
<li><p><strong>PERCENTILE_DISC &amp; PERCENTILE_CONT:</strong> these two work in the opposite way. Given a percent rank, find the value at that rank. They differ in that PERCENTILE_DISC will return a value that exists in the set while PERCENTILE_CONT will calculate an exact value if none of the values in the set falls precisely at that rank. You can use PERCENTILE_CONT to calculate a median by supplying 0.5 as the percent rank. For example, which temperature ranks at 50% in St. Louis?</p></li>
</ul>
</li>
</ul>
<p><strong>One problem is you cannot add window functions to the WHERE clause.</strong></p>
</div>
<div class="section" id="questions">
<h2>Questions<a class="headerlink" href="#questions" title="Permalink to this headline">¶</a></h2>
<div class="tip dropdown admonition">
<p class="admonition-title">Problem: [Leetcode] Rank Scores</p>
<p><strong>Reference - <a class="reference external" href="https://leetcode.com/problems/rank-scores/">Leetcode</a></strong></p>
<p>Write a SQL query to rank scores. If there is a tie between two scores, both should have the same ranking. Note that after a tie, the next ranking number should be the next consecutive integer value. In other words, there should be no “holes” between ranks.</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>Id</p></th>
<th class="head"><p>Score</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>3.40</p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>3.65</p></td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td><p>4.00</p></td>
</tr>
<tr class="row-odd"><td><p>4</p></td>
<td><p>3.50</p></td>
</tr>
<tr class="row-even"><td><p>5</p></td>
<td><p>4.00</p></td>
</tr>
<tr class="row-odd"><td><p>6</p></td>
<td><p>3.65</p></td>
</tr>
</tbody>
</table>
<p>For example, given the above Scores table, your query should generate the following report (order by highest score):</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>score</p></th>
<th class="head"><p>Rank</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>4.00</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-odd"><td><p>4.00</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-even"><td><p>3.95</p></td>
<td><p>2</p></td>
</tr>
<tr class="row-odd"><td><p>3.65</p></td>
<td><p>3</p></td>
</tr>
<tr class="row-even"><td><p>3.65</p></td>
<td><p>3</p></td>
</tr>
<tr class="row-odd"><td><p>3.40</p></td>
<td><p>4</p></td>
</tr>
</tbody>
</table>
</div>
<div class="dropdown admonition">
<p class="admonition-title">Solution:</p>
<p>The tie resolving method which is being asked in the question is called Dense Rank, if we use Rank it will have “holes”</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">select</span> 
<span class="n">Score</span><span class="p">,</span> <span class="n">dense_rank</span><span class="p">()</span> <span class="n">over</span><span class="p">(</span><span class="k">order</span> <span class="k">by</span> <span class="n">score</span> <span class="k">desc</span><span class="p">)</span> <span class="k">as</span> <span class="n">Rank</span>
<span class="k">from</span> <span class="n">Scores</span>
</pre></div>
</div>
</div>
<div class="tip dropdown admonition">
<p class="admonition-title">Problem: [CHEWY] 2nd Highest score</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-align:right head"><p>Id</p></th>
<th class="head"><p>subject</p></th>
<th class="text-align:right head"><p>marks</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:right"><p>1</p></td>
<td><p>Maths</p></td>
<td class="text-align:right"><p>30</p></td>
</tr>
<tr class="row-odd"><td class="text-align:right"><p>1</p></td>
<td><p>Phy</p></td>
<td class="text-align:right"><p>50</p></td>
</tr>
<tr class="row-even"><td class="text-align:right"><p>1</p></td>
<td><p>Chem</p></td>
<td class="text-align:right"><p>85</p></td>
</tr>
<tr class="row-odd"><td class="text-align:right"><p>2</p></td>
<td><p>Maths</p></td>
<td class="text-align:right"><p>90</p></td>
</tr>
<tr class="row-even"><td class="text-align:right"><p>2</p></td>
<td><p>Phy</p></td>
<td class="text-align:right"><p>50</p></td>
</tr>
<tr class="row-odd"><td class="text-align:right"><p>2</p></td>
<td><p>Chem</p></td>
<td class="text-align:right"><p>85</p></td>
</tr>
</tbody>
</table>
<p>Select the second highest mark for each student.</p>
</div>
<div class="dropdown admonition">
<p class="admonition-title">Solution:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">CTE</span> <span class="k">as</span><span class="p">(</span>
	<span class="k">select</span> <span class="o">*</span><span class="p">,</span> <span class="n">rank</span><span class="p">()</span> <span class="n">over</span><span class="p">(</span><span class="n">partition</span> <span class="k">by</span> <span class="n">Id</span> <span class="k">order</span> <span class="k">by</span> <span class="n">marks</span> <span class="k">desc</span><span class="p">)</span> <span class="k">as</span> <span class="n">Rank</span> <span class="k">from</span> <span class="n">tablename</span>
<span class="p">)</span>
<span class="k">select</span> <span class="n">Id</span><span class="p">,</span> <span class="n">subject</span><span class="p">,</span> <span class="n">marks</span> <span class="k">from</span> <span class="n">CTE</span> <span class="k">where</span> <span class="n">Rank</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
<div class="tip dropdown admonition">
<p class="admonition-title">Problem: [Leetcode] Consecutive Numbers</p>
<p><strong>Reference - <a class="reference external" href="https://leetcode.com/problems/consecutive-numbers/">Leetcode</a></strong></p>
<p>Write an SQL query to find all numbers that appear at least three times consecutively.</p>
<p>Return the result table in any order.</p>
<p>Input:</p>
<p>Logs table:</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>Id</p></th>
<th class="head"><p>Num</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-odd"><td><p>4</p></td>
<td><p>2</p></td>
</tr>
<tr class="row-even"><td><p>5</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-odd"><td><p>6</p></td>
<td><p>2</p></td>
</tr>
<tr class="row-even"><td><p>7</p></td>
<td><p>2</p></td>
</tr>
</tbody>
</table>
<p>Result table:</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>ConsecutiveNums</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
</tr>
</tbody>
</table>
<p>1 is the only number that appears consecutively for at least three times.</p>
</div>
<div class="dropdown admonition">
<p class="admonition-title">Solution:</p>
<p>Multiple solutions are possible, one of them is given below</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">a</span><span class="p">(</span><span class="n">Num</span><span class="p">,</span><span class="n">NextNum</span><span class="p">,</span><span class="n">SecondNextNum</span> <span class="p">)</span> <span class="k">as</span><span class="p">(</span>

	<span class="k">SELECT</span>   <span class="n">Num</span>
	         <span class="p">,</span> <span class="n">LEAD</span><span class="p">(</span><span class="n">Num</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="n">OVER</span> <span class="p">(</span><span class="k">ORDER</span> <span class="k">BY</span> <span class="n">Id</span><span class="p">)</span> <span class="k">AS</span> <span class="n">NextNum</span>
	         <span class="p">,</span> <span class="n">LEAD</span><span class="p">(</span><span class="n">Num</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="n">OVER</span> <span class="p">(</span><span class="k">ORDER</span> <span class="k">BY</span> <span class="n">Id</span><span class="p">)</span> <span class="k">AS</span> <span class="n">SecondNextNum</span>
	      <span class="k">FROM</span> <span class="n">Logs</span>
	      
	<span class="p">)</span>

	<span class="k">select</span> <span class="k">distinct</span><span class="p">(</span><span class="n">Num</span><span class="p">)</span> <span class="k">as</span> <span class="n">ConsecutiveNums</span> <span class="k">from</span> <span class="n">a</span>
	<span class="k">where</span>
	<span class="n">Num</span> <span class="o">=</span> <span class="n">NextNum</span>
	<span class="k">and</span> <span class="n">Num</span> <span class="o">=</span> <span class="n">SecondNextNum</span>
</pre></div>
</div>
</div>
<div class="tip dropdown admonition">
<p class="admonition-title">Problem: [SALESFORCE] User Growth</p>
<p><strong><a class="reference external" href="https://dbfiddle.uk/?rdbms=sqlserver_2017&amp;fiddle=ce4ded37fa37bf552365c18cb7840c3b">🔫Playground</a></strong></p>
<p>Given you have user data for 2 accounts for 2 months. Calculate the growth rate of users in each account where growth rate is defined as unique users in month 2 divided by unique users in month 1.</p>
</div>
<div class="dropdown admonition">
<p class="admonition-title">Solution:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">cte</span> <span class="k">as</span> <span class="p">(</span>
	<span class="k">select</span> <span class="n">account_id</span><span class="p">,</span> <span class="k">count</span><span class="p">(</span><span class="k">distinct</span><span class="p">(</span><span class="n">user_id</span><span class="p">))</span> <span class="k">as</span> <span class="n">unique_user</span><span class="p">,</span> <span class="k">MONTH</span><span class="p">(</span><span class="n">date_details</span><span class="p">)</span> <span class="k">as</span> <span class="n">user_month</span> <span class="k">from</span> <span class="n">tablename</span>
	<span class="k">group</span> <span class="k">by</span> <span class="n">account_id</span><span class="p">,</span> <span class="k">MONTH</span><span class="p">(</span><span class="n">date_details</span><span class="p">)</span>
	<span class="p">)</span>

<span class="k">select</span> <span class="n">a</span><span class="p">.</span><span class="n">account_id</span><span class="p">,</span><span class="n">month_2</span><span class="p">,</span><span class="n">month_1</span><span class="p">,</span>
<span class="k">cast</span><span class="p">((</span><span class="n">month_2</span><span class="o">/</span><span class="n">month_1</span><span class="p">)</span><span class="k">as</span> <span class="nb">float</span><span class="p">)</span> <span class="k">as</span> <span class="n">growth</span>  <span class="k">from</span> 
<span class="p">(</span><span class="k">select</span> <span class="n">account_id</span><span class="p">,</span> <span class="n">unique_user</span> <span class="k">as</span> <span class="n">month_1</span>
<span class="k">from</span> <span class="n">cte</span> <span class="k">where</span> <span class="n">user_month</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span><span class="n">a</span>
<span class="k">left</span> <span class="k">join</span>
<span class="p">(</span><span class="k">select</span> <span class="n">account_id</span><span class="p">,</span> <span class="n">unique_user</span> <span class="k">as</span> <span class="n">month_2</span>
<span class="k">from</span> <span class="n">cte</span> <span class="k">where</span> <span class="n">user_month</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span><span class="n">b</span>
<span class="k">on</span> <span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">account_id</span> <span class="o">=</span> <span class="n">b</span><span class="p">.</span><span class="n">account_id</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="tip dropdown admonition">
<p class="admonition-title">Problem: [SALESFORCE] Month over Month Revenue</p>
<p><strong><a class="reference external" href="https://dbfiddle.uk/?rdbms=sqlserver_2017&amp;fiddle=72569e574e670b477d2f62fdfc4276ca">🔫Playground</a></strong></p>
<p>You have 2 tables:</p>
<ul class="simple">
<li><p>transactions: date, prod_id, quantity</p></li>
<li><p>products: prod_id, price</p></li>
</ul>
<p>Calculate the month over month revenue, example month over month revenue for month2 is month2_Revenue- month1_Revenue</p>
</div>
<div class="dropdown admonition">
<p class="admonition-title">Solution:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">cte</span> <span class="k">as</span><span class="p">(</span>
	<span class="k">select</span> <span class="k">MONTH</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">date_details</span><span class="p">)</span> <span class="k">as</span> <span class="k">month</span><span class="p">,</span> <span class="k">sum</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="n">price</span><span class="o">*</span><span class="n">a</span><span class="p">.</span><span class="n">qty</span><span class="p">)</span> <span class="k">as</span> <span class="n">Rev</span>
	<span class="k">from</span> <span class="n">transactions</span> <span class="n">a</span>
	<span class="k">inner</span> <span class="k">join</span> <span class="n">products</span> <span class="n">b</span>
	<span class="k">on</span> <span class="n">a</span><span class="p">.</span><span class="n">prod_id</span> <span class="o">=</span> <span class="n">b</span><span class="p">.</span><span class="n">prod_id</span>
	<span class="k">group</span> <span class="k">by</span> <span class="k">MONTH</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">date_details</span><span class="p">)</span>
	<span class="p">),</span>

	<span class="n">cte2</span> <span class="k">as</span><span class="p">(</span>
	<span class="k">select</span> <span class="k">month</span><span class="p">,</span> <span class="n">Rev</span><span class="p">,</span> <span class="n">lag</span><span class="p">(</span><span class="n">Rev</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="n">over</span><span class="p">(</span><span class="k">order</span> <span class="k">by</span> <span class="k">month</span><span class="p">)</span> <span class="k">as</span> <span class="n">prev_month</span>
	<span class="k">from</span> <span class="n">cte</span>
	<span class="p">)</span>

<span class="k">select</span> <span class="k">month</span><span class="p">,</span> <span class="p">(</span><span class="n">Rev</span><span class="o">-</span><span class="n">Prev_month</span><span class="p">)</span> <span class="k">as</span> <span class="n">extra_rev</span>  <span class="k">from</span> <span class="n">cte2</span>
<span class="k">where</span> 
<span class="n">prev_month</span> <span class="k">is</span> <span class="k">not</span> <span class="k">null</span>
</pre></div>
</div>
</div>
<div class="tip dropdown admonition">
<p class="admonition-title">Problem: [SALESFORCE] Employee earning more than their manager</p>
<p><strong>Reference - <a class="reference external" href="https://leetcode.com/problems/employees-earning-more-than-their-managers/">Leetcode</a></strong></p>
<p>Write an SQL query to find the employees who earn more than their managers.</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-align:right head"><p>Id</p></th>
<th class="head"><p>Name</p></th>
<th class="text-align:right head"><p>Salary</p></th>
<th class="text-align:right head"><p>ManagerId</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:right"><p>1</p></td>
<td><p>Joe</p></td>
<td class="text-align:right"><p>70000</p></td>
<td class="text-align:right"><p>3</p></td>
</tr>
<tr class="row-odd"><td class="text-align:right"><p>2</p></td>
<td><p>Henry</p></td>
<td class="text-align:right"><p>80000</p></td>
<td class="text-align:right"><p>4</p></td>
</tr>
<tr class="row-even"><td class="text-align:right"><p>3</p></td>
<td><p>Sam</p></td>
<td class="text-align:right"><p>60000</p></td>
<td class="text-align:right"><p></p></td>
</tr>
<tr class="row-odd"><td class="text-align:right"><p>4</p></td>
<td><p>Max</p></td>
<td class="text-align:right"><p>90000</p></td>
<td class="text-align:right"><p></p></td>
</tr>
</tbody>
</table>
<p>Output will be : Joe</p>
</div>
<div class="dropdown admonition">
<p class="admonition-title">Solution:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">cte</span> <span class="k">as</span><span class="p">(</span>
	<span class="k">Select</span> <span class="n">a</span><span class="p">.</span><span class="n">Name</span> <span class="k">as</span> <span class="n">Employee</span><span class="p">,</span> <span class="n">b</span><span class="p">.</span><span class="n">Name</span> <span class="k">as</span> <span class="n">Manager</span><span class="p">,</span> <span class="n">a</span><span class="p">.</span><span class="n">Salary</span> <span class="k">as</span> <span class="n">Emp_Sal</span><span class="p">,</span> <span class="n">b</span><span class="p">.</span><span class="n">Salary</span> <span class="k">as</span> <span class="n">Man_Salary</span>
	<span class="k">from</span> <span class="n">Employee</span> <span class="n">a</span>
	<span class="k">inner</span> <span class="k">join</span> <span class="n">Employee</span> <span class="n">b</span>
	<span class="k">on</span> <span class="n">a</span><span class="p">.</span><span class="n">ManagerId</span> <span class="o">=</span> <span class="n">b</span><span class="p">.</span><span class="n">id</span><span class="p">)</span>

<span class="k">Select</span> <span class="n">Employee</span> <span class="k">from</span> <span class="n">cte</span> <span class="k">where</span> <span class="n">Emp_Sal</span> <span class="o">&gt;</span> <span class="n">Man_Salary</span>
</pre></div>
</div>
</div>
<div class="tip dropdown admonition">
<p class="admonition-title">Problem: [Leetcode] Highest Salary in each Department</p>
<p><strong>Reference - <a class="reference external" href="https://leetcode.com/problems/department-highest-salary/">Leetcode</a></strong></p>
<p>Write an SQL query to find employees who have the highest salary in each of the departments.</p>
<p><img alt="image 3" src="../../_images/image33.PNG" /></p>
</div>
<div class="dropdown admonition">
<p class="admonition-title">Solution:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">cte</span> <span class="k">as</span><span class="p">(</span>
	<span class="k">select</span> <span class="n">Name</span><span class="p">,</span> <span class="n">Salary</span><span class="p">,</span> <span class="n">DepartmentId</span><span class="p">,</span>
	<span class="n">RANK</span><span class="p">()</span> <span class="n">over</span><span class="p">(</span><span class="n">Partition</span> <span class="k">by</span> <span class="n">DepartmentId</span> <span class="k">order</span> <span class="k">by</span> <span class="n">salary</span> <span class="k">desc</span><span class="p">)</span> <span class="k">as</span> <span class="n">Rank</span>
	<span class="k">from</span> <span class="n">Employee</span>
<span class="p">)</span>
		    
<span class="k">select</span> <span class="n">b</span><span class="p">.</span><span class="n">Name</span> <span class="k">as</span> <span class="n">Department</span><span class="p">,</span> <span class="n">a</span><span class="p">.</span><span class="n">Name</span> <span class="k">as</span> <span class="n">Employee</span><span class="p">,</span> <span class="n">a</span><span class="p">.</span><span class="n">Salary</span>
<span class="k">from</span> <span class="n">cte</span> <span class="n">a</span>
<span class="k">inner</span> <span class="k">join</span> <span class="n">Department</span> <span class="n">b</span>
<span class="k">on</span> <span class="n">a</span><span class="p">.</span><span class="n">DepartmentId</span> <span class="o">=</span> <span class="n">b</span><span class="p">.</span><span class="n">Id</span>
<span class="k">where</span> <span class="n">a</span><span class="p">.</span><span class="n">Rank</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
<div class="tip dropdown admonition">
<p class="admonition-title">Problem: [AMAZON] Cumulative Sum</p>
<p>Given a users table, write a query to get the cumulative number of new users added by day, with the total reset every month.</p>
<p><a class="reference external" href="https://dbfiddle.uk/?rdbms=sqlserver_2017&amp;fiddle=516b59f188aaf8c5c1296143d1b13bcd">🔫Playground</a></p>
</div>
<div class="dropdown admonition">
<p class="admonition-title">Solution:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">Select</span> <span class="n">Created_date</span>
<span class="p">,</span><span class="k">SUM</span><span class="p">(</span><span class="k">Count</span><span class="p">(</span><span class="n">Id</span><span class="p">))</span> <span class="n">OVER</span><span class="p">(</span><span class="n">partition</span> <span class="k">by</span> <span class="k">month</span><span class="p">(</span><span class="n">Created_date</span><span class="p">)</span> <span class="k">order</span> <span class="k">by</span> <span class="n">Created_date</span><span class="p">)</span> <span class="k">as</span> <span class="n">Total_users</span>
<span class="k">from</span> <span class="n">users</span>
<span class="k">group</span> <span class="k">by</span> <span class="n">Created_date</span>
</pre></div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./contents\SQL"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
            



<div class='prev-next-bottom'>
    
    <div id="prev">
        <a class="left-prev" href="Joins.html" title="previous page">
            <i class="prevnext-label fas fa-angle-left"></i>
            <div class="prevnext-info">
                <p class="prevnext-label">previous</p>
                <p class="prevnext-title">Joins</p>
            </div>
        </a>
    </div>
     <div id="next">
        <a class="right-next" href="Functions.html" title="next page">
            <div class="prevnext-info">
                <p class="prevnext-label">next</p>
                <p class="prevnext-title">Functions</p>
            </div>
            <i class="prevnext-label fas fa-angle-right"></i>
        </a>
     </div>

</div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Dip Ranjan Chatterjee<br/>
        
            &copy; Copyright MIT License.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
<script async="" src="https://www.google-analytics.com/analytics.js"></script>
<script>
                        window.ga = window.ga || function () {
                            (ga.q = ga.q || []).push(arguments) };
                        ga.l = +new Date;
                        ga('create', 'UA-60403888-2', 'auto');
                        ga('set', 'anonymizeIp', true);
                        ga('send', 'pageview');
                    </script>

  </body>
</html>