
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Windows Functions &#8212; The Data Science Interview Book</title>
    
  <link href="../../_static/css/theme.css" rel="stylesheet" />
  <link href="../../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/sphinx-book-theme.e8f53015daec13862f6db5e763c41738.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <link rel="canonical" href="https://dipranjan.github.io/dsinterviewqns/contents/SQL/Windows Functions.html" />
    <link rel="shortcut icon" href="../../_static/logo.gif"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Functions" href="Functions.html" />
    <link rel="prev" title="Joins" href="Joins.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
      <img src="../../_static/logo.gif" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">The Data Science Interview Book</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../intro.html">
   About this Book
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  To Do
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../To%20Do%20List.html">
   To Do
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Statistics
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../Statistics/Probability%20Basics.html">
   Probability Basics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Statistics/Probability%20Distribution.html">
   Probability Distribution
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Statistics/Central%20Limit%20Theorem.html">
   Central Limit Theorem
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Statistics/Bayesian%20vs%20Frequentist%20Reasoning.html">
   Bayesian vs Frequentist Reasoning
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Statistics/Hypothesis%20Testing.html">
   Hypothesis Testing
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Algorithms
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../Algorithms/Regression.html">
   Regression
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Algorithms/Generative%20VS%20Discriminative%20Models.html">
   Generative vs Discriminative Models
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Algorithms/Logistic%20Regression.html">
   Logistic Regression
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Algorithms/Time%20Series%20Analysis.html">
   Time Series Analysis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Algorithms/Anomaly%20Detection.html">
   Anomaly Detection
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  NLP
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../NLP/Lexical%20Processing.html">
   Lexical Processing
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Python
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../Python/Basics.html">
   Basics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Python/Data%20Manipulation.html">
   Data Manipulation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Python/Statistics.html">
   Statistics
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  SQL
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="Select.html">
   SQL Basics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Joins.html">
   Joins
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Windows Functions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Functions.html">
   Functions
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Excel
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../Excel/Excel%20Basics.html">
   Excel Basics
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Tensorflow
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../Tensorflow/Basics.html">
   Basics
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Analytical Thinking
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../Analytical%20Thinking/Business%20Scenarios.html">
   Business Scenarios
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  <a href="https://www.buymeacoffee.com/dearc" target="_blank"><img src="https://cdn.buymeacoffee.com/buttons/default-orange.png" alt="Buy Me A Coffee" height="41" width="174"></a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/contents/SQL/Windows Functions.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.md</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/dipranjan/dsinterviewqns"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/dipranjan/dsinterviewqns/issues/new?title=Issue%20on%20page%20%2Fcontents/SQL/Windows Functions.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        <a class="edit-button" href="https://github.com/dipranjan/dsinterviewqns/edit/master/contents/SQL/Windows Functions.md"><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Edit this page"><i class="fas fa-pencil-alt"></i>suggest edit</button></a>
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#questions">
   Questions
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="windows-functions">
<h1>Windows Functions<a class="headerlink" href="#windows-functions" title="Permalink to this headline">¶</a></h1>
<p><strong>Reference:</strong> <a class="reference external" href="https://www.red-gate.com/simple-talk/sql/t-sql-programming/introduction-to-t-sql-window-functions/">📖Explanation</a>, <a class="reference external" href="https://dbfiddle.uk/?rdbms=sqlserver_2017&amp;fiddle=6379904805d1f465cc0f6ea33fc3c0d6">🔫Playground</a></p>
<p>Window (also, windowing or windowed) functions perform a calculation over a set of rows. I like to think of “looking through the window” at the rows that are being returned and having one last chance to perform a calculation. The window is defined by the OVER clause which determines if the rows are partitioned into smaller sets and if they are ordered.
They allow you to add your favourite aggregate function to a non-aggregate query. Similar to Transform is pandas group by clause.</p>
<p>Some common windows functions are as follows:</p>
<ul class="simple">
<li><p><strong>Ranking functions</strong></p>
<ul>
<li><p>ROW_NUMBER: <em>is used to add unique row numbers to a partition or to the entire result set. It has the ability to turn non-unique rows into unique rows.</em></p></li>
<li><p>RANK: <em>it will give numbers same as row_number just that same data will get same rank</em></p></li>
<li><p>DENSE_RANK: <em>doesnot skip and rank number</em></p></li>
<li><p>NTILE: <em>It assigns bucket numbers to the rows instead of row numbers or ranks</em></p></li>
</ul>
</li>
</ul>
<div class="figure align-default" id="image2">
<img alt="../../_images/image24.PNG" src="../../_images/image24.PNG" />
<p class="caption"><span class="caption-number">Fig. 17 </span><span class="caption-text">Ranking functions, check playground to work with this</span><a class="headerlink" href="#image2" title="Permalink to this image">¶</a></p>
</div>
<ul class="simple">
<li><p><strong>Offset functions</strong></p>
<ul>
<li><p>LAG</p></li>
<li><p>LEAD</p></li>
<li><p>FIRST_VALUE</p></li>
<li><p>LAST_VALUE</p></li>
</ul>
</li>
<li><p><strong>Statistical functions</strong>
– PERCENT_RANK</p>
<ul>
<li><p>CUME_DIST</p></li>
<li><p>PERCENTILE_DISC</p></li>
<li><p>PERCENTILE_CONT</p></li>
</ul>
</li>
</ul>
<p>One problem is you cannot add window functions to the WHERE clause.</p>
<div class="section" id="questions">
<h2>Questions<a class="headerlink" href="#questions" title="Permalink to this headline">¶</a></h2>
<div class="tip dropdown admonition">
<p class="admonition-title">Problem: Rank Scores</p>
<p><strong>Reference - <a class="reference external" href="https://leetcode.com/problems/rank-scores/">Leetcode</a></strong></p>
<p>Write a SQL query to rank scores. If there is a tie between two scores, both should have the same ranking. Note that after a tie, the next ranking number should be the next consecutive integer value. In other words, there should be no “holes” between ranks.</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>Id</p></th>
<th class="head"><p>Score</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>3.40</p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>3.65</p></td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td><p>4.00</p></td>
</tr>
<tr class="row-odd"><td><p>4</p></td>
<td><p>3.50</p></td>
</tr>
<tr class="row-even"><td><p>5</p></td>
<td><p>4.00</p></td>
</tr>
<tr class="row-odd"><td><p>6</p></td>
<td><p>3.65</p></td>
</tr>
</tbody>
</table>
<p>For example, given the above Scores table, your query should generate the following report (order by highest score):</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>score</p></th>
<th class="head"><p>Rank</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>4.00</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-odd"><td><p>4.00</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-even"><td><p>3.95</p></td>
<td><p>2</p></td>
</tr>
<tr class="row-odd"><td><p>3.65</p></td>
<td><p>3</p></td>
</tr>
<tr class="row-even"><td><p>3.65</p></td>
<td><p>3</p></td>
</tr>
<tr class="row-odd"><td><p>3.40</p></td>
<td><p>4</p></td>
</tr>
</tbody>
</table>
</div>
<div class="dropdown admonition">
<p class="admonition-title">Solution:</p>
<p>The tie resolving method which is being asked in the question is called Dense Rank, if we use Rank it will have “holes”</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>`
select 
Score, dense_rank() over(order by score desc) as Rank
from Scores
`
</pre></div>
</div>
</div>
<div class="tip dropdown admonition">
<p class="admonition-title">Problem: 2nd Highest score</p>
<p><strong>Asked By - CHEWY</strong></p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-align:right head"><p>Id</p></th>
<th class="head"><p>subject</p></th>
<th class="text-align:right head"><p>marks</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:right"><p>1</p></td>
<td><p>Maths</p></td>
<td class="text-align:right"><p>30</p></td>
</tr>
<tr class="row-odd"><td class="text-align:right"><p>1</p></td>
<td><p>Phy</p></td>
<td class="text-align:right"><p>50</p></td>
</tr>
<tr class="row-even"><td class="text-align:right"><p>1</p></td>
<td><p>Chem</p></td>
<td class="text-align:right"><p>85</p></td>
</tr>
<tr class="row-odd"><td class="text-align:right"><p>2</p></td>
<td><p>Maths</p></td>
<td class="text-align:right"><p>90</p></td>
</tr>
<tr class="row-even"><td class="text-align:right"><p>2</p></td>
<td><p>Phy</p></td>
<td class="text-align:right"><p>50</p></td>
</tr>
<tr class="row-odd"><td class="text-align:right"><p>2</p></td>
<td><p>Chem</p></td>
<td class="text-align:right"><p>85</p></td>
</tr>
</tbody>
</table>
<p>Select the second highest mark for each student.</p>
</div>
<div class="dropdown admonition">
<p class="admonition-title">Solution:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>`
with CTE as(
select *, rank() over(partition by Id order by marks desc) as Rank from tablename
)

select Id, subject, marks from CTE where Rank = 1
`
</pre></div>
</div>
</div>
<div class="tip dropdown admonition">
<p class="admonition-title">Problem: Consecutive Numbers</p>
<p><strong>Reference - <a class="reference external" href="https://leetcode.com/problems/consecutive-numbers/">Leetcode</a></strong></p>
<p>Write an SQL query to find all numbers that appear at least three times consecutively.</p>
<p>Return the result table in any order.</p>
<p>Input:</p>
<p>Logs table:</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>Id</p></th>
<th class="head"><p>Num</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-odd"><td><p>4</p></td>
<td><p>2</p></td>
</tr>
<tr class="row-even"><td><p>5</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-odd"><td><p>6</p></td>
<td><p>2</p></td>
</tr>
<tr class="row-even"><td><p>7</p></td>
<td><p>2</p></td>
</tr>
</tbody>
</table>
<p>Result table:</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>ConsecutiveNums</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
</tr>
</tbody>
</table>
<p>1 is the only number that appears consecutively for at least three times.</p>
</div>
<div class="dropdown admonition">
<p class="admonition-title">Solution:</p>
<p>Multiple solutions are possible, one of them is given below</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>`

with a(Num,NextNum,SecondNextNum ) as(

SELECT   Num
         , LEAD(Num, 1) OVER (ORDER BY Id) AS NextNum
         , LEAD(Num, 2) OVER (ORDER BY Id) AS SecondNextNum
      FROM Logs
      
)

select distinct(Num) as ConsecutiveNums from a
where
Num = NextNum
and Num = SecondNextNum

`
</pre></div>
</div>
</div>
<div class="tip dropdown admonition">
<p class="admonition-title">Problem: User Growth</p>
<p><strong>Asked By - SALESFORCE</strong>
<strong><a class="reference external" href="https://dbfiddle.uk/?rdbms=sqlserver_2017&amp;fiddle=ce4ded37fa37bf552365c18cb7840c3b">🔫Playground</a></strong></p>
<p>Given you have user data for 2 accounts for 2 months. Calculate the growth rate of users in each account where growth rate is defined as unique users in month 2 divided by unique users in month 1.</p>
</div>
<div class="dropdown admonition">
<p class="admonition-title">Solution:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>`
with cte as (
select account_id, count(distinct(user_id)) as unique_user, MONTH(date_details) as user_month from tablename
group by account_id, MONTH(date_details)
)

select a.account_id,month_2,month_1,
cast((month_2/month_1)as float) as growth  from 
(select account_id, unique_user as month_1
from cte where user_month = 1)a
left join
(select account_id, unique_user as month_2
from cte where user_month = 2)b
on (a.account_id = b.account_id)
`
</pre></div>
</div>
</div>
<div class="tip dropdown admonition">
<p class="admonition-title">Problem: Month over Month Revenue</p>
<p><strong>Asked By - SALESFORCE</strong>
<strong><a class="reference external" href="https://dbfiddle.uk/?rdbms=sqlserver_2017&amp;fiddle=72569e574e670b477d2f62fdfc4276ca">🔫Playground</a></strong></p>
<p>You have 2 tables:</p>
<ul class="simple">
<li><p>transactions: date, prod_id, quantity</p></li>
<li><p>products: prod_id, price</p></li>
</ul>
<p>Calculate the month over month revenue, example month over month revenue for month2 is month2_Revenue- month1_Revenue</p>
</div>
<div class="dropdown admonition">
<p class="admonition-title">Solution:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>`
with 
cte as(
select MONTH(a.date_details) as month, sum(b.price*a.qty) as Rev
from transactions a
inner join products b
on a.prod_id = b.prod_id
group by MONTH(a.date_details)
),

cte2 as(
select month, Rev, lag(Rev,1) over(order by month) as prev_month
from cte
)

select month, (Rev-Prev_month) as extra_rev  from cte2
where 
prev_month is not null
`
</pre></div>
</div>
</div>
<div class="tip dropdown admonition">
<p class="admonition-title">Problem: Employee earning more than their manager</p>
<p><strong>Reference - <a class="reference external" href="https://leetcode.com/problems/employees-earning-more-than-their-managers/">Leetcode</a></strong>
<strong>Asked By - SALESFORCE</strong></p>
<p>Write an SQL query to find the employees who earn more than their managers.</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-align:right head"><p>Id</p></th>
<th class="head"><p>Name</p></th>
<th class="text-align:right head"><p>Salary</p></th>
<th class="text-align:right head"><p>ManagerId</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:right"><p>1</p></td>
<td><p>Joe</p></td>
<td class="text-align:right"><p>70000</p></td>
<td class="text-align:right"><p>3</p></td>
</tr>
<tr class="row-odd"><td class="text-align:right"><p>2</p></td>
<td><p>Henry</p></td>
<td class="text-align:right"><p>80000</p></td>
<td class="text-align:right"><p>4</p></td>
</tr>
<tr class="row-even"><td class="text-align:right"><p>3</p></td>
<td><p>Sam</p></td>
<td class="text-align:right"><p>60000</p></td>
<td class="text-align:right"><p></p></td>
</tr>
<tr class="row-odd"><td class="text-align:right"><p>4</p></td>
<td><p>Max</p></td>
<td class="text-align:right"><p>90000</p></td>
<td class="text-align:right"><p></p></td>
</tr>
</tbody>
</table>
<p>Output will be : Joe</p>
</div>
<div class="dropdown admonition">
<p class="admonition-title">Solution:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>`

with cte as(
Select a.Name as Employee, b.Name as Manager, a.Salary as Emp_Sal, b.Salary as Man_Salary
from Employee a
inner join Employee b
on a.ManagerId = b.id)

Select Employee from cte where Emp_Sal &gt; Man_Salary

`
</pre></div>
</div>
</div>
<div class="tip dropdown admonition">
<p class="admonition-title">Problem: Highest Salary in each Department</p>
<p><strong>Reference - <a class="reference external" href="https://leetcode.com/problems/department-highest-salary/">Leetcode</a></strong></p>
<p>Write an SQL query to find employees who have the highest salary in each of the departments.</p>
<p><img alt="image 3" src="../../_images/image33.PNG" /></p>
</div>
<div class="dropdown admonition">
<p class="admonition-title">Solution:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>`
	with cte as(
	select Name, Salary, DepartmentId,
	RANK() over(Partition by DepartmentId order by salary desc) as Rank
	from Employee
	    )
	    
	select b.Name as Department, a.Name as Employee, a.Salary
	from cte a
	inner join Department b
	on a.DepartmentId = b.Id
	where a.Rank = 1
`
</pre></div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./contents\SQL"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
            



<div class='prev-next-bottom'>
    
    <div id="prev">
        <a class="left-prev" href="Joins.html" title="previous page">
            <i class="prevnext-label fas fa-angle-left"></i>
            <div class="prevnext-info">
                <p class="prevnext-label">previous</p>
                <p class="prevnext-title">Joins</p>
            </div>
        </a>
    </div>
     <div id="next">
        <a class="right-next" href="Functions.html" title="next page">
            <div class="prevnext-info">
                <p class="prevnext-label">next</p>
                <p class="prevnext-title">Functions</p>
            </div>
            <i class="prevnext-label fas fa-angle-right"></i>
        </a>
     </div>

</div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Dip Ranjan Chatterjee<br/>
        
            &copy; Copyright MIT License.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
<script async="" src="https://www.google-analytics.com/analytics.js"></script>
<script>
                        window.ga = window.ga || function () {
                            (ga.q = ga.q || []).push(arguments) };
                        ga.l = +new Date;
                        ga('create', 'UA-60403888-2', 'auto');
                        ga('set', 'anonymizeIp', true);
                        ga('send', 'pageview');
                    </script>

  </body>
</html>